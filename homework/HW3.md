## Домашнее задание №3: Работа с API myTarget
 
#### Цель домашнего задания
 
  * Научиться делать то же самое, что и браузер, но самостоятельно через API-запросы.
    Работа с API идет без документации, просто по аналогии с тем, как работает браузер с запросами (на примере сущностей из ДЗ №2).
  * Научиться писать тесты с использованием библиотеки requests.
 
#### Зависимости
 
  ДЗ выполняется в ветке homework3 и отдельной папке homework3. В папке homework3 должна лежать ваша ДЗ, никаких подпапок code и т.д.
 
  Ваша ветка с ДЗ должна быть синхронизирована с `main`.
 
  **На каждый PUSH кода в репозиторий будет срабатывать GitHub Actions.** Вы можете посмотреть результаты прогонов самостоятельно во вкладке Actions (см. пост на портале с инструкций), особенно если они будут "красными".
  **Настоятельно просим вас НЕ пушить постоянно код**, делайте это осмысленно и как можно реже.
 
#### Задача
 * Тестирование портала https://target-sandbox.my.com
 * Настроить окружение для запуска API-тестов.
 * API-тесты должны запускаться через марк -m API.
 * Все тесты должны работать как минимум в 2 потока (через [pytest-xdist](https://pypi.org/project/pytest-xdist/) с аргументом -n 2).
 * Описание ДЗ (10 баллов):  
     * **Написать API клиент, который будет иметь возможность авторизовываться на портале (3 балла).**
     * Написать тест на работу с кампанией кампании любого типа через API: кампания должна быть создана, затем проверена, что она создана, после этого - удалена (2 балла).
       Все в рамках одного теста.
     * Написать тест на работу с сегментами в аудиториях через API : сегмент должен быть создаен, затем проверен, что он создался, после этого - удален (2 балл).
       Все в рамках одного теста.
     * Написать тест на создание сегмента, предварительно добавив в [источники данных](https://target-sandbox.my.com/segments/groups_list) группу [VK образования](https://vk.com/vkedu).
       После этого вам нужно создать сегмент (как и в пункте выше) с типом "Группы OK и VK", проверить, что он есть, а затем **удалить** именно этот сегмент и добавленный источник данных (3 балла)
       
PS: Мы впервые работаем с API именно на sandbox-версии, а последнее (4-е) задание ранее не давали. Если возникнут какие-то проблемы в процессе ДЗ - не бойтесь задавать вопросы в чате.
   
#### Советы и рекомендации
  * По API:
   
    а) Авторизация делается по аналогии с лекциями - разобраться в авторизации на портале, разобраться где брать csrf-токен, какие запросы нужно сделать.
       **Куки, csrf-token и прочее должны храниться в сессии** (requests.Session). Логин и пароль - хардкодим.
   
    б) Если вы загружаете какие-то изображения для кампании - сначала загрузите их в таргет с помощью специальной API и получите их ID.
       **Путь к файлам задавать через repo_root**! Ваши тесты должны запускаться из любой части репозитория и не зависеть от указания пути к файлу.
   
    в) Список кампаний и сегментов (или конкретную кампанию/сегмент) можно также получить по API, а дальше с этими данными работать (например, удалять).
 
    г) Везде, где в данных для API фигурирует поле id - это значит, что эти данные хардкодить нельзя, а нужно разобраться, откуда они берутся.
 
    д) Не все заголовки, которые используются в запросах через браузер, нужны при API-запросах. Проверяйте "методом тыка".
  * **Можно сделать только часть заданий в любой последовательности**, оценка будет проставлена согласно разбалловке выше. Это нормально, заданий специально с запасом.
  * Тесты *НЕ* должны быть зависимыми. Генерируйте уникальные названия (через uuid, через время с секундами или как-то иначе) - это вам позволит определить, какие сущности вы создаете и легко их найти.
  * Тесты **ОБЯЗАТЕЛЬНО** должны что-то проверять. Например если мы что-то создали - необходимо проверить, что оно создалось. При необходимости выносить части кода в отдельные методы.
  * Если вам нужно что-то удалять - сначала создайте этот объект в тесте, а уже затем его удаляйте.  
  * Все тесты **ДОЛЖНЫ** проходить, как в один поток, так и в параллельном режиме (не конфликтовать).
  * Тесты **ДОЛЖНЫ** уметь запускаться несколько раз подряд, т.е. чтобы данные в тестах никак не конфликтовали.
 
 
#### Срок сдачи ДЗ
 До 31 октября (включительно)